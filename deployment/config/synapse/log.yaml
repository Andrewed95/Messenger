# Synapse Logging Configuration
# Production-grade structured logging with appropriate levels

version: 1

formatters:
  precise:
    format: '%(asctime)s - %(name)s - %(lineno)d - %(levelname)s - %(request)s - %(message)s'

handlers:
  console:
    class: logging.StreamHandler
    formatter: precise
    stream: ext://sys.stdout

  # File handler for structured logs (optional - mainly using stdout for Kubernetes)
  file:
    class: logging.handlers.RotatingFileHandler
    formatter: precise
    filename: /data/homeserver.log
    maxBytes: 104857600  # 100MB
    backupCount: 10

loggers:
  # Main Synapse logger
  synapse:
    level: INFO

  # HTTP requests - useful for debugging
  synapse.http.server:
    level: INFO

  # Federation - important for debugging federation issues
  synapse.federation:
    level: INFO

  # Storage layer - set to WARNING to reduce noise
  synapse.storage:
    level: WARNING

  # Replication - important for worker debugging
  synapse.replication:
    level: INFO

  # Media - track media operations
  synapse.media:
    level: INFO

  # Access logs - detailed request logging
  synapse.access.http:
    level: INFO

  # SQL - set to WARNING unless debugging database issues
  synapse.storage.SQL:
    level: WARNING

root:
  level: INFO
  handlers: [console]

# Disable overly verbose third-party loggers
disable_existing_loggers: false

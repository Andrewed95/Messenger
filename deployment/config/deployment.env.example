# Matrix/Synapse Production Deployment Configuration
# Matrix Production Deployment - 20K CCU
# Version: 2.0

# ============================================================================
# COPY THIS FILE TO deployment.env AND FILL IN YOUR VALUES
# ============================================================================
# cp deployment.env.example deployment.env
# Edit deployment.env with your specific values
# DO NOT commit deployment.env to version control!

# ============================================================================
# DOMAIN CONFIGURATION
# ============================================================================
MATRIX_DOMAIN="chat.z3r0d3v.com"  # Your Matrix server domain
MATRIX_SERVER_NAME="chat.z3r0d3v.com"  # Matrix server name (usually same as domain)

# ============================================================================
# STORAGE CLASSES
# ============================================================================
# Check available storage classes: kubectl get storageclass
STORAGE_CLASS_GENERAL="local-path"  # For general use
STORAGE_CLASS_DATABASE="local-path"  # For PostgreSQL (prefer fast NVMe/SSD)
STORAGE_CLASS_MINIO="local-path"  # For MinIO object storage

# ============================================================================
# METALLB IP ADDRESS POOL
# ============================================================================
# IP range for LoadBalancer services (must be available on your network)
METALLB_IP_RANGE="192.168.1.240-192.168.1.250"

# ============================================================================
# NODE LABELS
# ============================================================================
# Nodes for LiveKit (comma-separated, e.g., "node1,node2,node3,node4")
LIVEKIT_NODES="node1,node2,node3,node4"

# Nodes for coturn (comma-separated, e.g., "node5,node6")
COTURN_NODES="node5,node6"

# ============================================================================
# POSTGRESQL CONFIGURATION
# ============================================================================
POSTGRES_PASSWORD="CHANGE_TO_SECURE_PASSWORD"  # PostgreSQL synapse user password
POSTGRES_BACKUP_S3_ACCESS_KEY="CHANGE_TO_MINIO_ACCESS_KEY"
POSTGRES_BACKUP_S3_SECRET_KEY="CHANGE_TO_MINIO_SECRET_KEY"

# ============================================================================
# MINIO CONFIGURATION
# ============================================================================
MINIO_ROOT_USER="admin"
MINIO_ROOT_PASSWORD="CHANGE_TO_SECURE_PASSWORD"
MINIO_SYNAPSE_ACCESS_KEY="CHANGE_TO_GENERATED_ACCESS_KEY"
MINIO_SYNAPSE_SECRET_KEY="CHANGE_TO_GENERATED_SECRET_KEY"

# ============================================================================
# SYNAPSE SECRETS
# ============================================================================
# Generate with: openssl rand -base64 32

SYNAPSE_REGISTRATION_SHARED_SECRET="CHANGE_TO_RANDOM_SECRET"
SYNAPSE_MACAROON_SECRET="CHANGE_TO_RANDOM_SECRET"
SYNAPSE_FORM_SECRET="CHANGE_TO_RANDOM_SECRET"

# Synapse signing key (generate with synapse generate command)
# Leave empty to auto-generate during deployment
SYNAPSE_SIGNING_KEY=""

# ============================================================================
# COTURN CONFIGURATION
# ============================================================================
# Shared secret for TURN authentication (must match between coturn and Synapse)
# Generate with: openssl rand -base64 32
COTURN_SHARED_SECRET="CHANGE_TO_SHARED_SECRET"

# coturn node IPs (must be accessible from clients)
COTURN_NODE1_IP="192.168.1.100"
COTURN_NODE2_IP="192.168.1.101"

# ============================================================================
# LIVEKIT CONFIGURATION
# ============================================================================
# Generate with: openssl rand -base64 32
LIVEKIT_API_KEY="CHANGE_TO_GENERATED_API_KEY"
LIVEKIT_API_SECRET="CHANGE_TO_GENERATED_API_SECRET"

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================
GRAFANA_ADMIN_PASSWORD="CHANGE_TO_SECURE_PASSWORD"

# ============================================================================
# TLS / CERTIFICATES
# ============================================================================
# Options: letsencrypt-prod, letsencrypt-staging, selfsigned, internal-ca
CERT_ISSUER="letsencrypt-prod"

# Email for Let's Encrypt (required if using letsencrypt)
LETSENCRYPT_EMAIL="admin@example.com"

# ============================================================================
# ADMIN ACCESS
# ============================================================================
# IP addresses allowed to access admin interfaces (Synapse Admin, Grafana, MinIO Console)
# Comma-separated CIDR blocks
ADMIN_IP_WHITELIST="10.0.0.0/8,192.168.0.0/16"

# Your specific admin IP for emergency access
ADMIN_PUBLIC_IP="1.2.3.4"  # CHANGE_TO_YOUR_IP

# ============================================================================
# RESOURCE SCALING
# ============================================================================
# Deployment size: small, medium, large
DEPLOYMENT_SIZE="large"  # For 20K CCU

# Worker counts (for large deployment)
SYNAPSE_SYNC_WORKERS="8"
SYNAPSE_GENERIC_WORKERS="4"
SYNAPSE_FEDERATION_SENDERS="4"
SYNAPSE_EVENT_PERSISTERS="2"

# ============================================================================
# OPTIONAL: FEDERATION
# ============================================================================
# Enable Matrix federation (true/false)
FEDERATION_ENABLED="false"

# If enabled, whitelist specific domains (comma-separated)
FEDERATION_WHITELIST=""  # e.g., "matrix.org,trusted-domain.com"

# ============================================================================
# OPTIONAL: BACKUP CONFIGURATION
# ============================================================================
# S3-compatible endpoint for external backups (if using)
EXTERNAL_BACKUP_ENDPOINT=""
EXTERNAL_BACKUP_BUCKET=""
EXTERNAL_BACKUP_ACCESS_KEY=""
EXTERNAL_BACKUP_SECRET_KEY=""

# ============================================================================
# OPTIONAL: SMTP CONFIGURATION
# ============================================================================
# For email notifications (password resets, etc.)
SMTP_HOST=""
SMTP_PORT="587"
SMTP_USER=""
SMTP_PASSWORD=""
SMTP_FROM="noreply@${MATRIX_DOMAIN}"

# ============================================================================
# NOTES
# ============================================================================
# After filling in values:
# 1. source deployment.env
# 2. Run deployment scripts in order (scripts/deploy-all.sh)
# 3. Secrets will be automatically created from these values
# 4. For production, consider using a secrets management solution
#    (Sealed Secrets, External Secrets Operator, Vault, etc.)
# ============================================================================

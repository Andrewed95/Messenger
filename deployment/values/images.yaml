# Image Configuration for Matrix/Synapse Deployment
# =============================================
# This file contains all configurable image URLs for the deployment.
# Replace these with your actual image URLs from your container registry.
#
# IMPORTANT: This solution assumes all images are pre-built and available.
# No image building is performed as part of this deployment.

# Core Matrix/Synapse Images
synapse:
  main:
    image: matrixdotorg/synapse:v1.119.0
    imagePullPolicy: IfNotPresent

  workers:
    # All workers use the same Synapse image
    image: matrixdotorg/synapse:v1.119.0
    imagePullPolicy: IfNotPresent

  li:
    # Lawful Intercept instance uses same Synapse version
    image: matrixdotorg/synapse:v1.119.0
    imagePullPolicy: IfNotPresent

# Infrastructure Services
postgresql:
  # CloudNativePG operator manages PostgreSQL images
  image: ghcr.io/cloudnative-pg/postgresql:16.1
  imagePullPolicy: IfNotPresent

redis:
  image: redis:7.2-alpine
  imagePullPolicy: IfNotPresent

minio:
  # MinIO Operator manages MinIO images
  image: minio/minio:RELEASE.2024-01-01T16-36-33Z
  imagePullPolicy: IfNotPresent

haproxy:
  image: haproxy:2.9-alpine
  imagePullPolicy: IfNotPresent

# Auxiliary Services
element_web:
  # Element Web client (main instance)
  image: vectorim/element-web:v1.11.77
  imagePullPolicy: IfNotPresent

element_web_li:
  # Element Web LI client (CUSTOM BUILD REQUIRED)
  #
  # CRITICAL: This MUST be a custom-built image, NOT standard vectorim/element-web!
  # Standard Element Web will NOT display deleted message content.
  #
  # Custom components included in element-web-li/:
  #   - LIRedactedBody: Shows original content of deleted messages
  #   - LIRedactedEventsStore: Stores and retrieves redacted events
  #   - Custom CSS: Visual distinction for deleted messages
  #
  # Build procedure:
  #   1. cd element-web-li/
  #   2. docker build -t registry.yourorg.com/matrix/element-web-li:v1.11.96 .
  #   3. docker push registry.yourorg.com/matrix/element-web-li:v1.11.96
  #   4. Update image reference below with your registry URL
  #
  # Replace "registry.example.com" with your organization's private registry
  #
  image: registry.example.com/matrix/element-web-li:v1.11.96
  imagePullPolicy: IfNotPresent

coturn:
  # TURN/STUN server
  image: coturn/coturn:4.6.2-alpine
  imagePullPolicy: IfNotPresent

livekit:
  # WebRTC SFU for voice/video calls
  image: livekit/livekit-server:v1.8.1
  imagePullPolicy: IfNotPresent

# NOTE: Sygnal (push notification gateway) intentionally NOT included
# Per CLAUDE.md Rule 4.3: No external services - deployment operates without internet
# Push notifications require connection to external Apple/Google servers
# See deployment/docs/PUSH-NOTIFICATIONS-GUIDE.md for alternatives

# Antivirus Services
clamav:
  image: clamav/clamav:stable-alpine
  imagePullPolicy: IfNotPresent

content_scanner:
  # Matrix content scanner that integrates with ClamAV
  image: vectorim/matrix-content-scanner:v2.1.0
  imagePullPolicy: IfNotPresent

# Custom Services (You must provide these images)
key_vault:
  # Django service for LI encrypted recovery key storage
  #
  # IMPORTANT: This image must be built from key_vault/
  # key_vault is a custom Django application, not a public image.
  #
  # Build procedure:
  #   1. cd key_vault/
  #   2. docker build -t registry.yourorg.com/matrix/key-vault:v1.0.0 .
  #   3. docker push registry.yourorg.com/matrix/key-vault:v1.0.0
  #   4. Update image reference below with your registry URL
  #
  # Replace "registry.example.com" with your organization's private registry
  # Replace "yourorg" with your organization name
  #
  image: registry.example.com/matrix/key-vault:v1.0.0
  imagePullPolicy: IfNotPresent

sync_system:
  # Sync system for LI PostgreSQL logical replication setup
  # Uses postgres image for replication configuration
  image: postgres:16-alpine
  imagePullPolicy: IfNotPresent

# Monitoring Stack
prometheus:
  # Prometheus Operator manages these images
  image: prom/prometheus:v2.48.1
  imagePullPolicy: IfNotPresent

grafana:
  image: grafana/grafana:10.2.3
  imagePullPolicy: IfNotPresent

alertmanager:
  image: prom/alertmanager:v0.26.0
  imagePullPolicy: IfNotPresent

# Ingress Controller
nginx_ingress:
  controller:
    image: registry.k8s.io/ingress-nginx/controller:v1.9.6
    imagePullPolicy: IfNotPresent

  webhook:
    image: registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20231011-8b53cabe0
    imagePullPolicy: IfNotPresent

# Cert Manager
cert_manager:
  controller:
    image: quay.io/jetstack/cert-manager-controller:v1.13.3
    imagePullPolicy: IfNotPresent

  webhook:
    image: quay.io/jetstack/cert-manager-webhook:v1.13.3
    imagePullPolicy: IfNotPresent

  cainjector:
    image: quay.io/jetstack/cert-manager-cainjector:v1.13.3
    imagePullPolicy: IfNotPresent

# Image Pull Secrets (if using private registries)
imagePullSecrets: []
# Example:
# imagePullSecrets:
#   - name: registry-credentials

# Global Registry Override (optional)
# If set, prepends this to all image names
# Example: registry.example.com/matrix/
globalRegistry: ""